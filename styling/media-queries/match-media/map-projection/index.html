<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="color-scheme" content="dark light">
  <title>Map Projection Toggle</title>
  <script type="module" src="../../../../dist/mapml.js"></script>
  <link rel="stylesheet" href="../../../../global.css">
  <style media="">
    body {
      display: flex;
    }

    mapml-viewer {
      flex: 2;
      height: 50vh;
    }

    .description {
      padding: 20px;
      flex: 1;
    }

    @media (max-width: 768px) {
      .desktop-only {
        display: none;
      }

      body {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const map = document.querySelector('mapml-viewer');
      let projectionMatcher = map.matchMedia('(map-projection: OSMTILE)'),
            osmtile = map.querySelector('#OSMTILE'),
            cbmtile = map.querySelector('#CBMTILE');

      const hideLayer = (matchesOSMTILE) => {
        map.whenLayersReady().then(() => {
          if (matchesOSMTILE) {
            cbmtile.setAttribute('hidden','hidden');
            osmtile.removeAttribute('hidden');
          } else {
            osmtile.setAttribute('hidden','hidden');
            cbmtile.removeAttribute('hidden');
          }
        });
      };
      hideLayer(projectionMatcher.matches === 'true');
      document.querySelector('.switchOSM').addEventListener('click', () => map.projection='OSMTILE');
      document.querySelector('.switchCBMT').addEventListener('click', () => map.projection='CBMTILE');
              
      const changeHandler = (e) => {
          let matchesOSMTILE = projectionMatcher.matches === 'true';
          hideLayer(matchesOSMTILE); 
        };
        projectionMatcher.addEventListener('change', changeHandler);
    });
  </script>

  <mapml-viewer projection="OSMTILE" zoom="9" lat="44.630550504861795" lon="-103.86611938476564" controls>
    <map-layer media="(map-projection: OSMTILE)" id="OSMTILE" src="light.mapml" checked></map-layer>
    <map-layer media="(map-projection: CBMTILE)" id="CBMTILE" checked>
      <map-extent label="CBMT - Lambert" units="CBMTILE" checked >
        <map-input name="z" type="zoom" min="0" max="18"></map-input>
        <map-input name="y" type="location" units="tilematrix" axis="row"></map-input>
        <map-input name="x" type="location" units="tilematrix" axis="column"></map-input>
        <map-link rel="tile" tref="https://geoappext.nrcan.gc.ca/arcgis/rest/services/BaseMaps/CBMT3978/MapServer/tile/{z}/{y}/{x}?m4h=t" ></map-link>
      </map-extent>
    </map-layer>
  </mapml-viewer>

  <div class="description">
    <h2>Descriptions</h2>
    <button class="switchOSM">Change projection to OSMTILE</button>
    <button class="switchCBMT">Change projection to CBMTILE</button>
  </div>
</body>

</html>
