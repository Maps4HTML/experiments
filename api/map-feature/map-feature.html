<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="dark light">
    <title>&lt;map-feature&gt; API</title>
    <script type="module" src="dist/mapml-viewer.js"></script>
    <style>
      body {
        font-family: 'system-ui', sans-serif;
        max-width: 50rem;
        margin: 0 auto;
        padding: 0 1rem;
        overflow-wrap: break-word;
      }
      mapml-viewer {
        width: 100%;
        min-height: 50vh;
      }
      @media (prefers-color-scheme: dark) {
        .user-preference-message {
          display: none;
        }
      }
    </style>
    <script>
//      function addEmptyLayer() {
//        let layer = document.querySelector('#empty-layer').content.firstElementChild.cloneNode(true);
//        layer.label = 'Two Hat Man';
//        layer.checked = 'checked';
//        let map = document.querySelector('mapml-viewer');
//        map.appendChild(layer);
//      }
//      addEmptyLayer();
      function addMan() {
        let map = document.querySelector('mapml-viewer');
        let man = document.querySelector('#hatman').content.firstElementChild.cloneNode(true);
        let layer = document.querySelector("layer-[label='Empty']");
        layer.appendChild(man);
        layer.label = "Two Hat Man";
        toggleDisabled();
      }
      function toggleDisabled() {
        if (document.querySelector('#add').disabled) {
          document.querySelector('#add').disabled = false;
          document.querySelector('#focus').disabled = true;
          document.querySelector('#click').disabled = true;
          document.querySelector('#blur').disabled = true;
          document.querySelector('#zoom').disabled = true;
          document.querySelector('#replace').disabled = true;
          document.querySelector('#remove').disabled = true;
        } else {
          document.querySelector('#add').disabled = true;
          document.querySelector('#focus').disabled = false;
          document.querySelector('#click').disabled = false;
          document.querySelector('#blur').disabled = false;
          document.querySelector('#zoom').disabled = false;
          document.querySelector('#replace').disabled = false;
          document.querySelector('#remove').disabled = false;
        }
      }
      function focusMan() {
        document.querySelector('map-feature').focus();
      }
      function blurMan() {
        document.querySelector('map-feature').blur();
      }
      function addCustomClickHandler() {
        let man = document.querySelector('map-feature');
        man.onclick = function () {
        alert('Feature clicked');
        };
      }
      function removeMan() {
        document.querySelector('map-feature').remove();
        toggleDisabled();
      }
    </script>
    <template id="projection">
      <map-meta name="projection" content="OSMTILE"></map-meta>
    </template>
    <template id="empty-layer">
      <layer- label="Empty" checked>
        <map-meta name="projection" content="OSMTILE"></map-meta>
      </layer->
    </template>
    
    <template id="hatman">
        <map-feature id="twohats" zoom="15" class="twohats">
          <map-featurecaption>The Man With Two Hats</map-featurecaption>
          <map-properties>
            <table>
              <tr>
                <th>image</th>
                <td><a href="https://www.veterans.gc.ca/eng/remembrance/memorials/national-inventory-canadian-memorials/details/9304">
                  <img src="https://www.veterans.gc.ca/images/remembrance/memorials/national-inventory-canadian-memorials/mem/35059-173a.jpg" width="60" height="60"/>
                </a>
                </td>
              </tr>
            </table>
          </map-properties>
          <map-geometry cs="gcrs">
            <map-point>
              <map-coordinates>-75.705278 45.397778</map-coordinates>
            </map-point>
          </map-geometry>
        </map-feature>
    </template>
  </head>
  <body>
    <p>
    This document is to experiment with the event handling methods of the
    <a href="https://maps4html.org/web-map-doc/docs/api/map-feature-api/">HTMLFeatureElement API</a>.
    </p>

    
    <mapml-viewer projection="OSMTILE" zoom="1" lat="50" lon="-100" controls>
      <layer- label="CBMT" src="https://maps4html.org/experiments/refactoring-temporary/osm.mapml" checked></layer->
      <layer- label="Empty" checked>
        <map-meta name="projection" content="OSMTILE"></map-meta>
      </layer->
    </mapml-viewer>
  <button id="add" onclick="addMan()">Add feature</button>
  <button id="focus" disabled onclick="document.querySelector('map-feature').focus()">Focus feature</button>
  <button id="blur" disabled  onclick="document.querySelector('map-feature').blur()">Blur feature</button>
  <button id="click" disabled  onclick="document.querySelector('map-feature').click()">Click feature</button>
  <button id="zoom" disabled  onclick="document.querySelector('map-feature').zoomTo()">Zoom to feature</button>
  <button id="replace" disabled  onclick="addCustomClickHandler()">Replace default click handler</button>
  <button id="remove" disabled onclick="removeMan()">Remove feature</button>
  </body>
</html>
